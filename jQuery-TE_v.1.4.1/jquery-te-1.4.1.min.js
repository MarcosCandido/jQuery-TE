/*!
 *
 * jQuery TE 1.4.1 , http://jqueryte.com/
 * Copyright (C) 2013, Fatih Koca (fattih@fattih.com), (http://jqueryte.com/about)

 * jQuery TE is provided under the MIT LICENSE.
 *
*/
!function(e){JQTE_VARFORMAT={AT:1,BRACKETS:2},e.fn.jqte=function(t){function s(e,t,s,a,i){var l=u.length+1;return u.push({name:e,cls:l,command:t,key:s,tag:a,emphasis:i})}var a=[{title:"Text Format"},{title:"Font Size"},{title:"Color"},{title:"Bold",hotkey:"B"},{title:"Italic",hotkey:"I"},{title:"Underline",hotkey:"U"},{title:"Ordered List",hotkey:"."},{title:"Unordered List",hotkey:","},{title:"Subscript",hotkey:"down arrow"},{title:"Superscript",hotkey:"up arrow"},{title:"Outdent",hotkey:"left arrow"},{title:"Indent",hotkey:"right arrow"},{title:"Justify Left"},{title:"Justify Center"},{title:"Justify Right"},{title:"Strike Through",hotkey:"K"},{title:"Add Link",hotkey:"L"},{title:"Remove Link"},{title:"Cleaner Style",hotkey:"Delete"},{title:"Horizontal Rule",hotkey:"H"},{title:"Source"},{title:"Insert Variable"}],i=[["p","Normal"],["h1","Header 1"],["h2","Header 2"],["h3","Header 3"],["h4","Header 4"],["h5","Header 5"],["h6","Header 6"],["pre","Preformatted"]],l=["10","12","16","18","20","24","28"],n=["0,0,0","68,68,68","102,102,102","153,153,153","204,204,204","238,238,238","243,243,243","255,255,255",null,"255,0,0","255,153,0","255,255,0","0,255,0","0,255,255","0,0,255","153,0,255","255,0,255",null,"244,204,204","252,229,205","255,242,204","217,234,211","208,224,227","207,226,243","217,210,233","234,209,220","234,153,153","249,203,156","255,229,153","182,215,168","162,196,201","159,197,232","180,167,214","213,166,189","224,102,102","246,178,107","255,217,102","147,196,125","118,165,175","111,168,220","142,124,195","194,123,160","204,0,0","230,145,56","241,194,50","106,168,79","69,129,142","61,133,198","103,78,167","166,77,121","153,0,0","180,95,6","191,144,0","56,118,29","19,79,92","11,83,148","53,28,117","116,27,71","102,0,0","120,63,4","127,96,0","39,78,19","12,52,61","7,55,99","32,18,77","76,17,48"],o=["Web Address","E-mail Address","Picture URL"],r=e.extend({status:!0,css:"jqte",title:!0,titletext:a,button:"OK",format:!0,formats:i,fsize:!0,fsizes:l,funit:"px",color:!0,linktypes:o,variables:!1,variable_format:JQTE_VARFORMAT.BRACKETS,b:!0,i:!0,u:!0,ol:!0,ul:!0,sub:!0,sup:!0,outdent:!0,indent:!0,left:!0,center:!0,right:!0,strike:!0,link:!0,unlink:!0,remove:!0,rule:!0,source:!0,placeholder:!1,br:!0,p:!0,change:"",focus:"",blur:""},t);if(r.variables&&r.variables.length){for(var c=0;c<r.variables.length;c++)if("string"==typeof r.variables[c]&&(r.variables[c]={name:r.variables[c]}),r.variables[c]=e.extend({name:null,text:null,parms:!1},r.variables[c]),r.variables[c].parms)for(var d=0;d<r.variables[c].parms.length;d++)"string"==typeof r.variables[c].parms[d]&&(r.variables[c].parms[d]={text:r.variables[c].parms[d]}),r.variables[c].parms[d]=e.extend({text:null},r.variables[c].parms[d])}else r.variables=!1;e.fn.jqteVal=function(t){e(this).closest("."+r.css).find("."+r.css+"_editor").html(t)};var f=navigator.userAgent.toLowerCase();/msie [1-7]./.test(f)&&(r.title=!1);var u=[];return s("format","formats","","",!1),s("fsize","fSize","","",!1),s("color","colors","","",!1),s("b","Bold","B",["b","strong"],!0),s("i","Italic","I",["i","em"],!0),s("u","Underline","U",["u"],!0),s("ol","insertorderedlist","¾",["ol"],!0),s("ul","insertunorderedlist","¼",["ul"],!0),s("sub","subscript","(",["sub"],!0),s("sup","superscript","&",["sup"],!0),s("outdent","outdent","%",["blockquote"],!1),s("indent","indent","'",["blockquote"],!0),s("left","justifyLeft","","",!1),s("center","justifyCenter","","",!1),s("right","justifyRight","","",!1),s("strike","strikeThrough","K",["strike"],!0),s("link","linkcreator","L",["a"],!0),s("unlink","unlink","",["a"],!1),s("remove","removeformat",".","",!1),s("rule","inserthorizontalrule","H",["hr"],!1),s("source","displaysource","","",!1),r.variables&&r.variables.length&&s("variables","variablecreator","","",!1),this.each(function(){function t(){return window.getSelection?window.getSelection():document.selection&&document.selection.createRange&&"None"!=document.selection.type?document.selection.createRange():void 0}function s(e,s){var a,l=t();if(window.getSelection)if(l.anchorNode&&l.getRangeAt&&(a=l.getRangeAt(0)),a&&(l.removeAllRanges(),l.addRange(a)),f.match(/msie/)||document.execCommand("StyleWithCSS",!1,!1),document.queryCommandSupported(e))document.execCommand(e,!1,s);else if("inserttext"==e.toLowerCase()){var n=document.createDocumentFragment();n.textContent=s,a.insertNode(n)}else console.log("Command not supported: "+e+". Parameter: "+s);else if(document.selection&&document.selection.createRange&&"None"!=document.selection.type)if(a=document.selection.createRange(),document.queryCommandSupported(e))a.execCommand(e,!1,s);else if("inserttext"==e.toLowerCase()){var n=document.createDocumentFragment();n.textContent=s,a.insertNode(n)}i(!1,!1)}function a(s,a,l){if(D.not(":focus")&&D.focus(),window.getSelection){var n,o,r,c=t();c.anchorNode&&c.getRangeAt&&(n=c.getRangeAt(0),o=document.createElement(s),e(o).attr(a,l),r=n.extractContents(),o.appendChild(r),n.insertNode(o),c.removeAllRanges(),"style"==a?i(e(o),l):i(e(o),!1))}else if(document.selection&&document.selection.createRange&&"None"!=document.selection.type){var d=document.selection.createRange(),f=d.htmlText,u="<"+s+" "+a+'="'+l+'">'+f+"</"+s+">";document.selection.createRange().pasteHTML(u)}}function i(e,t){var s=me();if(s=s?s:e,s&&0==t)s.parent().is("[style]")&&!s.parent().is("."+r.css+"_editor")&&s.attr("style",s.parent().attr("style")),s.is("[style]")&&!s.parent().is("."+r.css+"_editor")&&s.find("*").attr("style",s.attr("style"));else if(e&&t&&e.is("[style]")){var a=t.split(";");a=a[0].split(":"),e.is("[style*="+a[0]+"]")&&e.find("*").css(a[0],a[1]),l(e)}}function l(t){if(t){var t=t[0];if(document.body.createTextRange){var s=document.body.createTextRange();s.moveToElementText(t),s.select()}else if(window.getSelection){var a=window.getSelection(),s=document.createRange();"undefined"!=t&&null!=t&&(s.selectNodeContents(t),a.removeAllRanges(),a.addRange(s),e(t).is(":empty")&&(e(t).append("&nbsp;"),l(e(t))))}}}function o(){if(H.data("sourceOpened"))d(!1);else{var t=me(),s="http://";if(b(!1),d(!0),t){var i=t.prop("tagName").toLowerCase();"a"==i&&t.is("[href]")?(s=t.attr("href"),t.attr(K,"")):a("a",K,"")}else B.val(s).focus();U.off("click.jqte").on("click.jqte",function(t){(e(t.target).hasClass(r.css+"_linktypetext")||e(t.target).hasClass(r.css+"_linktypearrow"))&&v(W.is(":visible")?!1:!0)}),W.find("a").off("click.jqte").on("click.jqte",function(){var t=e(this).attr(r.css+"-linktype");W.data("linktype",t),J.find("."+r.css+"_linktypetext").html(W.find("a:eq("+W.data("linktype")+")").text()),m(s),v()}),m(s),B.focus().val(s).bind("keypress keyup",function(e){return 13==e.keyCode?(c(E.find("["+K+"]")),!1):void 0}),V.off("click.jqte").on("click.jqte",function(){c(E.find("["+K+"]"))})}}function c(t){B.focus(),l(t),t.removeAttr(K),"2"!=W.data("linktype")?s("createlink",B.val()):(s("insertImage",B.val()),D.find("img").each(function(){var t=e(this).prev("a"),s=e(this).next("a");t.length>0&&""==t.html()?t.remove():s.length>0&&""==s.html()&&s.remove()})),d(),D.trigger("change")}function d(e){x("["+K+"]:not([href])"),E.find("["+K+"][href]").removeAttr(K),e?(H.data("linkOpened",!0),$.show()):(H.data("linkOpened",!1),$.hide()),v()}function v(e){e?W.show():W.hide()}function m(e){var t=W.data("linktype");"1"!=t||"http://"!=B.val()&&!B.is("[value^=http://]")&&B.is("[value^=mailto]")?"1"==t||B.is("[value^=http://]")?B.val(e):B.val("http://"):B.val("mailto:")}function h(){H.data("sourceOpened")?b(!1):(d(!1),b(!0),Q.off("click.jqte").on("click.jqte",function(t){(e(t.target).hasClass(r.css+"_variabletext")||e(t.target).hasClass(r.css+"_variablearrow")||e(t.target).hasClass(r.css+"_variableview"))&&_(X.is(":visible")?!1:!0)}),X.find("a").off("click.jqte").on("click.jqte",function(){var t=e(this).attr(r.css+"-variable");X.data("variable",t),Y.find("."+r.css+"_variabletext").html(X.find("a:eq("+X.data("variable")+")").text()),y(r.variables[t]?r.variables[t].parms:null),_(!1)}),y(X.data("variable")&&r.variables[X.data("variable")]?r.variables[X.data("variable")].parms:null),G.off("click.jqte").on("click.jqte",function(){p()}))}function p(){if(X.data("variable")&&r.variables[X.data("variable")]){var e=r.variables[X.data("variable")],t="";if(e.parms&&e.parms.length)for(var a=0;a<e.parms.length;a++)t&&(t+=","),t+=E.find("input."+r.css+"_variableparminput[name=parm"+a+"]").val();var i=!1;E.hasClass(r.css+"_focused")||(i=!0,D.focus());var l=g(e.name,t);if(s("insertText",l),D.trigger("change"),i&&document.createRange&&window.getSelection){var n=document.createRange();n.setStart(D.get(0).firstChild,0),n.setEnd(D.get(0).firstChild,l.length);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}}_(!1)}function g(e,t){switch(r.variable_format){default:case JQTE_VARFORMAT.AT:return"@"+e+(t?":"+t:"");case JQTE_VARFORMAT.BRACKETS:return"{{"+e+(t?":"+t:"")+"}}"}}function b(e){x("["+Z+"]:not([href])"),E.find("["+Z+"][href]").removeAttr(Z),e?(H.data("variablesOpened",!0),I.show()):(H.data("variablesOpened",!1),I.hide()),_(!1)}function _(e){e?X.show():X.hide()}function y(e){if(e&&e.length){for(var t="",s=0;s<e.length;s++)t+='<label class="'+r.css+'_variableparmlabel unselectable" unselectable="on">'+e[s].text+':</label><input class="'+r.css+'_variableparminput" name="parm'+s+'">';P.html(t),P.find("input").bind("keypress keyup",function(e){return 13==e.keyCode?(p(),!1):void 0})}else P.html("")}function k(t){H.data("sourceOpened")?C(styleField,!1):("fSize"==t?styleField=ue:"colors"==t&&(styleField=ve),C(styleField,!0),styleField.find("a").unbind("click").click(function(){var s=e(this).attr(r.css+"-styleval");"fSize"==t?(styleType="font-size",s+=r.funit):"colors"==t&&(styleType="color",s="rgb("+s+")");var i=w(styleType);a("span","style",styleType+":"+s+";"+i),C("",!1),e("."+r.css+"_title").remove(),D.trigger("change")})),d(!1)}function C(e,t){var s="",a=[{d:"fsizeOpened",f:ue},{d:"cpallOpened",f:ve}];if(""!=e)for(var i=0;i<a.length;i++)e==a[i].f&&(s=a[i]);if(t){H.data(s.d,!0),s.f.slideDown(100);for(var i=0;i<a.length;i++)s.d!=a[i].d&&(H.data(a[i].d,!1),a[i].f.slideUp(100))}else for(var i=0;i<a.length;i++)H.data(a[i].d,!1),a[i].f.slideUp(100)}function x(t){E.find(t).each(function(){e(this).before(e(this).html()).remove()})}function w(e){var t=me();if(t&&t.is("[style]")&&""!=t.css(e)){var s=t.css(e);t.css(e,"");var a=t.attr("style");return t.css(e,s),a}return""}function R(){A(!0),fe.find("a").click(function(){e("*",this).click(function(e){return e.preventDefault(),!1}),S(e(this).text());var t=e(this).attr(r.css+"-formatval");s("formatBlock","<"+t+">"),A(!1)})}function A(e){var t=e?!0:!1;t=e&&fe.data("status")?!0:!1,t||!e?fe.data("status",!1).slideUp(200):fe.data("status",!0).slideDown(200)}function S(e){var t=fe.closest("."+r.css+"_tool").find("."+r.css+"_tool_label").find("."+r.css+"_tool_text");e.length>10&&(e=e.substr(0,7)+"..."),t.html(e)}function T(e){var t,s,a;for(t=e.replace(/\n/gim,"").replace(/\r/gim,"").replace(/\t/gim,"").replace(/&nbsp;/gim," "),s=[/\<span(|\s+.*?)><span(|\s+.*?)>(.*?)<\/span><\/span>/gim,/<(\w*[^p])\s*[^\/>]*>\s*<\/\1>/gim,/\<div(|\s+.*?)>(.*?)\<\/div>/gim,/\<strong(|\s+.*?)>(.*?)\<\/strong>/gim,/\<em(|\s+.*?)>(.*?)\<\/em>/gim],a=["<span$2>$3</span>","","<p$1>$2</p>","<b$1>$2</b>","<i$1>$2</i>"],oe=0;5>oe;oe++)for(var i=0;i<s.length;i++)t=t.replace(s[i],a[i]);if(r.p||(t=t.replace(/\<p(|\s+.*?)>(.*?)\<\/p>/gi,"<br/>$2")),!r.br){s=[/\<br>(.*?)/gi,/\<br\/>(.*?)/gi],a=["<p>$1</p>","<p>$1</p>"];for(var i=0;i<s.length;i++)t=t.replace(s[i],a[i])}return r.p||r.br||(t=t.replace(/\<p>(.*?)\<\/p>/gi,"<div>$1</div>")),t}function q(){var e=""==D.text()&&D.html().length<12?"":D.html();O.val(T(e))}function j(){D.html(T(O.val()))}function z(t){var s,a=!1,i=me();return i?(e.each(t,function(t,l){s=i.prop("tagName").toLowerCase(),s==l?a=!0:i.parents().each(function(){s=e(this).prop("tagName").toLowerCase(),s==l&&(a=!0)})}),a):!1}function F(t){for(var s=0;s<u.length;s++)r[u[s].name]&&u[s].emphasis&&""!=u[s].tag&&(z(u[s].tag)?H.find("."+r.css+"_tool_"+u[s].cls).addClass(M):e("."+r.css+"_tool_"+u[s].cls).removeClass(M));if(r.format&&e.isArray(r.formats)){for(var a=!1,i=0;i<r.formats.length;i++){var l=[];if(l[0]=r.formats[i][0],r.formats[i][0].length>0&&z(l)){S(r.formats[i][1]),a=!0;break}}a||S(r.formats[0][1])}C("",!1),A(!1)}if(e(this).data("jqte")&&null!=e(this).data("jqte")&&"undefined"!=e(this).data("jqte")?e(this).data("jqte",!1):e(this).data("jqte",!0),r.status&&e(this).data("jqte")){var O=e(this),N=e(this).prop("tagName").toLowerCase();e(this).attr("data-origin",N);var L=e(this).is("[value]")||"textarea"==N?e(this).val():e(this).html();L=L.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),e(this).after('<div class="'+r.css+'"></div>');var E=e(this).next("."+r.css);E.html('<div class="'+r.css+'_toolbar" role="toolbar" unselectable></div><div class="'+r.css+'_linkform" style="display:none" role="dialog"></div><div class="'+r.css+'_variablesform" style="display:none" role="dialog"></div><div class="'+r.css+'_editor"></div>');var H=E.find("."+r.css+"_toolbar"),$=E.find("."+r.css+"_linkform"),I=E.find("."+r.css+"_variablesform"),D=E.find("."+r.css+"_editor"),M=r.css+"_tool_depressed";$.append('<div class="'+r.css+'_linktypeselect" unselectable></div><input class="'+r.css+'_linkinput" type="text/css" value=""><div class="'+r.css+'_linkbutton" unselectable>'+r.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var U=$.find("."+r.css+"_linktypeselect"),B=$.find("."+r.css+"_linkinput"),V=$.find("."+r.css+"_linkbutton");U.append('<div class="'+r.css+'_linktypeview" unselectable></div><div class="'+r.css+'_linktypes" role="menu" unselectable></div>');var W=U.find("."+r.css+"_linktypes"),J=U.find("."+r.css+"_linktypeview"),K=r.css+"-setlink";I.append('<div class="'+r.css+'_variableselect" unselectable></div><div class="'+r.css+'_variableparms"></div><div class="'+r.css+'_variablebutton" unselectable>'+r.button+'</div> <div style="height:1px;float:none;clear:both"></div>');var Q=I.find("."+r.css+"_variableselect"),P=I.find("."+r.css+"_variableparms"),G=I.find("."+r.css+"_variablebutton");Q.append('<div class="'+r.css+'_variableview" unselectable></div><div class="'+r.css+'_variables" role="menu" unselectable></div>');var X=Q.find("."+r.css+"_variables");E.mouseup(function(){X.css("max-height",D.height()+"px")}).mouseup();var Y=Q.find("."+r.css+"_variableview"),Z=r.css+"-setvariable";D.after('<div class="'+r.css+"_source "+r.css+'_hiddenField"></div>');var ee=E.find("."+r.css+"_source");if(O.appendTo(ee),"textarea"!=N){var te="";e(O[0].attributes).each(function(){"type"!=this.nodeName&&"value"!=this.nodeName&&(te=te+" "+this.nodeName+'="'+this.nodeValue+'"')}),O.replaceWith("<textarea "+te+">"+L+"</textarea>"),O=ee.find("textarea")}D.attr("contenteditable","true").html(L);for(var se=0;se<u.length;se++)if(r[u[se].name]&&("variables"!=u[se].name||r.variables&&r.variables.length)){var ae=u[se].key.length>0&&null!=r.titletext[se].hotkey&&"undefined"!=r.titletext[se].hotkey&&""!=r.titletext[se].hotkey?" (Ctrl+"+r.titletext[se].hotkey+")":"",ie=null!=r.titletext[se].title&&"undefined"!=r.titletext[se].title&&""!=r.titletext[se].title?r.titletext[se].title+ae:"";if(H.append('<div class="'+r.css+"_tool "+r.css+"_tool_"+u[se].cls+'" role="button" data-tool="'+se+'" unselectable><a class="'+r.css+'_tool_icon" unselectable></a></div>'),H.find("."+r.css+"_tool[data-tool="+se+"]").data({tag:u[se].tag,command:u[se].command,emphasis:u[se].emphasis,title:ie}),"format"==u[se].name&&e.isArray(r.formats)){var le=r.formats[0][1].length>0&&"undefined"!=r.formats[0][1]?r.formats[0][1]:"";H.find("."+r.css+"_tool_"+u[se].cls).find("."+r.css+"_tool_icon").replaceWith('<a class="'+r.css+'_tool_label" unselectable><span class="'+r.css+'_tool_text" unselectable>'+le+'</span><span class="'+r.css+'_tool_icon" unselectable></span></a>'),H.find("."+r.css+"_tool_"+u[se].cls).append('<div class="'+r.css+'_formats" unselectable></div>');for(var ne=0;ne<r.formats.length;ne++)H.find("."+r.css+"_formats").append("<a "+r.css+'-formatval="'+r.formats[ne][0]+'" class="'+r.css+"_format "+r.css+"_format_"+ne+'" role="menuitem" unselectable>'+r.formats[ne][1]+"</a>");H.find("."+r.css+"_formats").data("status",!1)}else if("fsize"==u[se].name&&e.isArray(r.fsizes)){H.find("."+r.css+"_tool_"+u[se].cls).append('<div class="'+r.css+'_fontsizes" unselectable></div>');for(var ne=0;ne<r.fsizes.length;ne++)H.find("."+r.css+"_fontsizes").append("<a "+r.css+'-styleval="'+r.fsizes[ne]+'" class="'+r.css+'_fontsize" style="font-size:'+r.fsizes[ne]+r.funit+'" role="menuitem" unselectable>Abcdefgh...</a>')}else if("color"==u[se].name&&e.isArray(n)){H.find("."+r.css+"_tool_"+u[se].cls).append('<div class="'+r.css+'_cpalette" unselectable></div>');for(var oe=0;oe<n.length;oe++)null!=n[oe]?H.find("."+r.css+"_cpalette").append("<a "+r.css+'-styleval="'+n[oe]+'" class="'+r.css+'_color" style="background-color: rgb('+n[oe]+')" role="gridcell" unselectable></a>'):H.find("."+r.css+"_cpalette").append('<div class="'+r.css+'_colorSeperator"></div>')}else"variables"==u[se].name&&H.find("."+r.css+"_tool[data-tool="+se+"]").data("format",r.variable_format).addClass(r.css+"_varformat_"+r.variable_format)}W.data("linktype","0");for(var se=0;3>se;se++)W.append("<a "+r.css+'-linktype="'+se+'" unselectable>'+r.linktypes[se]+"</a>"),J.html('<div class="'+r.css+'_linktypearrow" unselectable></div><div class="'+r.css+'_linktypetext">'+W.find("a:eq("+W.data("linktype")+")").text()+"</div>");if(X.data("variable",""),r.variables&&r.variables.length)for(var se=0;se<r.variables.length;se++)X.append("<a "+r.css+'-variable="'+se+'" unselectable>'+(r.variables[se].text||r.variables[se].name)+"</a>"),Y.html('<div class="'+r.css+'_variablearrow" unselectable></div><div class="'+r.css+'_variabletext">'+(""==X.data("variable")?"&nbsp;":X.find("a:eq("+X.data("variable")+")").text())+"</div>");var re="";if(re=/msie/.test(f)?"-ms-":/chrome/.test(f)||/safari/.test(f)||/yandex/.test(f)?"-webkit-":/mozilla/.test(f)?"-moz-":/opera/.test(f)?"-o-":/konqueror/.test(f)?"-khtml-":"",r.placeholder){E.prepend('<div class="'+r.css+'_placeholder" unselectable><div class="'+r.css+'_placeholder_text">'+r.placeholder+"</div></div>");var ce=E.find("."+r.css+"_placeholder");ce.click(function(){D.focus()})}E.find("[unselectable]").css(re+"user-select","none").addClass("unselectable").attr("unselectable","on").on("selectstart mousedown",!1);var de=H.find("."+r.css+"_tool"),fe=H.find("."+r.css+"_formats"),ue=H.find("."+r.css+"_fontsizes"),ve=H.find("."+r.css+"_cpalette"),me=function(){var t,s;if(window.getSelection&&(s=getSelection(),t=s.anchorNode),!t&&document.selection&&document.selection.createRange&&"None"!=document.selection.type){s=document.selection;var a=s.getRangeAt?s.getRangeAt(0):s.createRange();t=a.commonAncestorContainer?a.commonAncestorContainer:a.parentElement?a.parentElement():a.item(0)}return t?e("#text"==t.nodeName?t.parentNode:t):!1};de.unbind("click").click(function(t){"displaysource"!=e(this).data("command")||H.data("sourceOpened")?(H.data("sourceOpened")?(H.data("sourceOpened",!1),H.find("."+r.css+"_tool").removeClass(r.css+"_hiddenField"),ee.addClass(r.css+"_hiddenField"),D.removeClass(r.css+"_hiddenField")):"linkcreator"==e(this).data("command")?H.data("linkOpened")?(d(!1),A(!1)):o():"variablecreator"==e(this).data("command")?H.data("variablesOpened")?(b(!1),A(!1)):h():"formats"==e(this).data("command")?("formats"!=e(this).data("command")||e(t.target).hasClass(r.css+"_format")||R(),C("",!1),D.not(":focus")&&D.focus()):"fSize"==e(this).data("command")||"colors"==e(this).data("command")?(("fSize"==e(this).data("command")&&!e(t.target).hasClass(r.css+"_fontsize")||"colors"==e(this).data("command")&&!e(t.target).hasClass(r.css+"_color"))&&k(e(this).data("command")),A(!1),D.not(":focus")&&D.focus()):(D.not(":focus")&&D.focus(),s(e(this).data("command"),null),C("",!1),A(!1),v(),1!=e(this).data("emphasis")||e(this).hasClass(M)?e(this).removeClass(M):e(this).addClass(M),ee.addClass(r.css+"_hiddenField"),D.removeClass(r.css+"_hiddenField")),r.placeholder&&""!=r.placeholder&&(""!=D.html()?ce.hide():ce.show())):(H.find("."+r.css+"_tool").addClass(r.css+"_hiddenField"),e(this).removeClass(r.css+"_hiddenField"),H.data("sourceOpened",!0),O.css("height",D.outerHeight()),ee.removeClass(r.css+"_hiddenField"),D.addClass(r.css+"_hiddenField"),O.focus(),d(!1),C("",!1),A(),r.placeholder&&""!=r.placeholder&&ce.hide()),D.trigger("change")}).hover(function(t){if(r.title&&""!=e(this).data("title")&&(e(t.target).hasClass(r.css+"_tool")||e(t.target).hasClass(r.css+"_tool_icon"))){e("."+r.css+"_title").remove(),E.append('<div class="'+r.css+'_title"><div class="'+r.css+'_titleArrow"><div class="'+r.css+'_titleArrowIcon"></div></div><div class="'+r.css+'_titleText">'+e(this).data("title")+"</div></div>");var s=e("."+r.css+"_title:first"),a=(s.find("."+r.css+"_titleArrowIcon"),e(this).position()),i=a.left+e(this).outerWidth()-s.outerWidth()/2-e(this).outerWidth()/2,l=a.top+e(this).outerHeight()+5;s.delay(400).css({top:l,left:i}).fadeIn(200)}},function(){e("."+r.css+"_title").remove()});var he=null;D.bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){H.data("sourceOpened")||e(this).trigger("change"),v(),e.isFunction(r.change)&&r.change(),r.placeholder&&""!=r.placeholder&&(""!=e(this).text()?ce.hide():ce.show())}).bind("change",function(){H.data("sourceOpened")||(clearTimeout(he),he=setTimeout(q,10))}).keydown(function(e){if(e.ctrlKey)for(var t=0;t<u.length;t++)if(r[u[t].name]&&e.keyCode==u[t].key.charCodeAt(0))return"linkcreator"==u[t].command&&o(),"variablecreator"==u[t].command?h():""!=u[t].command&&s(u[t].command,null),!1}).bind("mouseup keyup",F).focus(function(){if(e.isFunction(r.focus)&&r.focus(),E.addClass(r.css+"_focused"),/opera/.test(f)){var t=document.createRange();t.selectNodeContents(D[0]),t.collapse(!1);var s=window.getSelection();s.removeAllRanges(),s.addRange(t)}}).focusout(function(){de.removeClass(M),C("",!1),A(!1),v(),e.isFunction(r.blur)&&r.blur(),E.removeClass(r.css+"_focused"),e.isArray(r.formats)&&S(r.formats[0][1])}),O.bind("keydown keyup",function(){setTimeout(j,0),e(this).height(e(this)[0].scrollHeight),""==e(this).val()&&e(this).height(0)}).focus(function(){E.addClass(r.css+"_focused")}).focusout(function(){E.removeClass(r.css+"_focused")})}else if(e(this).closest("."+r.css).length>0){var pe=e(this).closest("."+r.css).find("."+r.css+"_editor").html(),te="";e(e(this)[0].attributes).each(function(){"style"!=this.nodeName&&(te=te+" "+this.nodeName+'="'+this.nodeValue+'"')});var N=e(this).is("[data-origin]")&&""!=e(this).attr("data-origin")?e(this).attr("data-origin"):"textarea",ge=">"+pe;("input"==N||"option"==N)&&(pe=pe.replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ge='value="'+pe+'">');var be=e(this).clone();e(this).data("jqte",!1).closest("."+r.css).before(be).remove(),be.replaceWith("<"+N+te+ge+"</"+N+">")}})}}(jQuery);